# Generated by Django 4.2 on 2025-12-03

from django.db import migrations
import os


def force_reset_superuser_password(apps, schema_editor):
    """
    Force reset do password do superusu√°rio usando vari√°veis de ambiente
    """
    User = apps.get_model('auth', 'User')
    username = os.environ.get('DJANGO_SUPERUSER_USERNAME', 'admin')
    email = os.environ.get('DJANGO_SUPERUSER_EMAIL', 'admin@regionalveiculos.com')
    password = os.environ.get('DJANGO_SUPERUSER_PASSWORD', 'RegionalVeiculos2024!')
    
    try:
        # Procurar o usu√°rio admin
        user = User.objects.filter(username=username).first()
        
        if user:
            print(f'üîÑ For√ßando reset da senha do usu√°rio "{username}"...')
            user.set_password(password)
            user.email = email
            user.is_staff = True
            user.is_superuser = True
            user.is_active = True
            user.save()
            print(f'‚úÖ Senha do usu√°rio "{username}" foi resetada com sucesso!')
        else:
            print(f'üÜï Criando novo superusu√°rio "{username}"...')
            User.objects.create_superuser(
                username=username,
                email=email,
                password=password
            )
            print(f'‚úÖ Superusu√°rio "{username}" criado com sucesso!')
            
    except Exception as e:
        print(f'‚ùå Erro ao resetar senha do superusu√°rio: {e}')
        import traceback
        traceback.print_exc()


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0004_create_superuser'),
    ]

    operations = [
        migrations.RunPython(force_reset_superuser_password, reverse_code=migrations.RunPython.noop),
    ]
